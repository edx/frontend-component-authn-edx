{"version":3,"file":"useSubjectList.js","names":["useEffect","useState","getConfig","algoliasearch","algoliasearchHelper","defaultSubjectList","PRODUCT_INDEX","SUBJECT_FACET","getAlgoliaSearchClient","AUTHN_ALGOLIA_APP_ID","AUTHN_ALGOLIA_SEARCH_API_KEY","parseSubjectsFromAlgoliaResults","subjectsList","map","subject","label","name","useSubjectsList","setSubjectsList","subjectsLoading","setSubjectsLoading","searchClient","searchHelper","facets","searchIndex","search","on","_ref","results","getFacetValues","options"],"sources":["../../../../../src/forms/progressive-profiling-popup/data/hooks/useSubjectList.jsx"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nimport { getConfig } from '@edx/frontend-platform';\nimport algoliasearch from 'algoliasearch';\nimport algoliasearchHelper from 'algoliasearch-helper';\n\nimport { defaultSubjectList } from '../constants';\n\nconst PRODUCT_INDEX = 'product';\nconst SUBJECT_FACET = 'subject';\n\nconst getAlgoliaSearchClient = () => algoliasearch(\n  getConfig().AUTHN_ALGOLIA_APP_ID,\n  getConfig().AUTHN_ALGOLIA_SEARCH_API_KEY,\n);\n\nconst parseSubjectsFromAlgoliaResults = (subjectsList) => (\n  subjectsList.map(subject => ({ label: subject.name }))\n);\n\nconst useSubjectsList = () => {\n  const [subjectsList, setSubjectsList] = useState([]);\n  const [subjectsLoading, setSubjectsLoading] = useState(true);\n\n  useEffect(() => {\n    const searchClient = getAlgoliaSearchClient();\n    const searchHelper = algoliasearchHelper(\n      searchClient,\n      PRODUCT_INDEX,\n      { facets: [SUBJECT_FACET] },\n    );\n\n    const searchIndex = () => {\n      setSubjectsLoading(true);\n      searchHelper.search();\n    };\n\n    searchIndex();\n\n    searchHelper.on('result', ({ results }) => {\n      setSubjectsList(parseSubjectsFromAlgoliaResults(results.getFacetValues(SUBJECT_FACET, {})));\n      setSubjectsLoading(false);\n    });\n\n    searchHelper.on('error', () => {\n      setSubjectsLoading(false);\n      setSubjectsList(parseSubjectsFromAlgoliaResults(defaultSubjectList));\n    });\n  }, []);\n\n  return {\n    subjectsList: {\n      options: subjectsList,\n    },\n    subjectsLoading,\n  };\n};\n\nexport default useSubjectsList;\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAE3C,SAASC,SAAS,QAAQ,wBAAwB;AAClD,OAAOC,aAAa,MAAM,eAAe;AACzC,OAAOC,mBAAmB,MAAM,sBAAsB;AAEtD,SAASC,kBAAkB,QAAQ,cAAc;AAEjD,MAAMC,aAAa,GAAG,SAAS;AAC/B,MAAMC,aAAa,GAAG,SAAS;AAE/B,MAAMC,sBAAsB,GAAGA,CAAA,KAAML,aAAa,CAChDD,SAAS,CAAC,CAAC,CAACO,oBAAoB,EAChCP,SAAS,CAAC,CAAC,CAACQ,4BACd,CAAC;AAED,MAAMC,+BAA+B,GAAIC,YAAY,IACnDA,YAAY,CAACC,GAAG,CAACC,OAAO,KAAK;EAAEC,KAAK,EAAED,OAAO,CAACE;AAAK,CAAC,CAAC,CACtD;AAED,MAAMC,eAAe,GAAGA,CAAA,KAAM;EAC5B,MAAM,CAACL,YAAY,EAAEM,eAAe,CAAC,GAAGjB,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACkB,eAAe,EAAEC,kBAAkB,CAAC,GAAGnB,QAAQ,CAAC,IAAI,CAAC;EAE5DD,SAAS,CAAC,MAAM;IACd,MAAMqB,YAAY,GAAGb,sBAAsB,CAAC,CAAC;IAC7C,MAAMc,YAAY,GAAGlB,mBAAmB,CACtCiB,YAAY,EACZf,aAAa,EACb;MAAEiB,MAAM,EAAE,CAAChB,aAAa;IAAE,CAC5B,CAAC;IAED,MAAMiB,WAAW,GAAGA,CAAA,KAAM;MACxBJ,kBAAkB,CAAC,IAAI,CAAC;MACxBE,YAAY,CAACG,MAAM,CAAC,CAAC;IACvB,CAAC;IAEDD,WAAW,CAAC,CAAC;IAEbF,YAAY,CAACI,EAAE,CAAC,QAAQ,EAAEC,IAAA,IAAiB;MAAA,IAAhB;QAAEC;MAAQ,CAAC,GAAAD,IAAA;MACpCT,eAAe,CAACP,+BAA+B,CAACiB,OAAO,CAACC,cAAc,CAACtB,aAAa,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;MAC3Fa,kBAAkB,CAAC,KAAK,CAAC;IAC3B,CAAC,CAAC;IAEFE,YAAY,CAACI,EAAE,CAAC,OAAO,EAAE,MAAM;MAC7BN,kBAAkB,CAAC,KAAK,CAAC;MACzBF,eAAe,CAACP,+BAA+B,CAACN,kBAAkB,CAAC,CAAC;IACtE,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO;IACLO,YAAY,EAAE;MACZkB,OAAO,EAAElB;IACX,CAAC;IACDO;EACF,CAAC;AACH,CAAC;AAED,eAAeF,eAAe","ignoreList":[]}